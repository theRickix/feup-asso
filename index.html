<!doctype html>
<html>
  <meta charset="utf-8">
  <head>
    <title>Cylon.js Robot Events and Commands</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
    </style>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->
  </head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.0/socket.io.dev.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script type="text/javascript">
    var socket;
    $('document').ready(function() {
      socket = io.connect('http://localhost:8080');

      socket.emit('message', 'You are connected!');
      socket.emit('new device',{type: "dummy", name: "Bot1"});
      socket.emit('new device',{type: "keyboard", name: "Bot2"});
      var robot = [];

      function cylonConn() {
        var cylon = io.connect('http://localhost:3000/api');
        var device;
        cylon.on('robots', function(robots) {
          console.log('List of robots:', robots);
          console.log('_______________________');
          robots.forEach(function(element,i) {
               // Once we have a list of available robots we can use
               // any of them and connect to their socket.
               robot[i] = new Object;
               robot[i].name = element
               robot[i].socket = io('http://127.0.0.1:3000/api/robots/' + element);

               // Listen to the 'commands' event on device
               // returns a list of available commands for the device
               robot[i].socket.on('commands', function(commands) {
                 robot[i].commands = commands;
               });
               // Every time a event is executed the 'event' event
               // is triggered, returns the name of the event executed
               // and the value returned
               robot[i].socket.on('event', function(payload) {
                 msg = robot[i].name + " triggered '"+payload.name+"' with data '"+payload.data+"'";
                 console.log('Robot command name ==>', payload.name);
                 console.log('Robot command data ==>', payload.data);
                 $('#messages').append($('<li>').text(msg));
               });
               // Listen to the 'events' event on device
               // returns a list of available events for the device
               robot[i].socket.on('events', function(events) {
                robot[i].events = events;
               });

               // We emit 'commands' and 'events' so we can listen
               // and get the lists of available items
               robot[i].socket.emit('commands');
               robot[i].socket.emit('events');

          });
            
        });
        cylon.emit('robots');
      };


      setTimeout(cylonConn, 1000);

      var i=1;
     $("#add_row").click(function(){
      $('#row'+i).html("<td>"+ (i+1) +"</td><td><input name='name"+i+"' type='text' placeholder='Name' class='form-control input-md'  /> </td><td><input  name='mail"+i+"' type='text' placeholder='Mail'  class='form-control input-md'></td><td><input  name='mobile"+i+"' type='text' placeholder='Mobile'  class='form-control input-md'></td>");

      $('#tab_logic').append('<tr id="row'+(i+1)+'"></tr>');
      i++; 
  });
     $("#delete_row").click(function(){
       if(i>1){
     $("#row"+(i-1)).html('');
     i--;
     }
   });
     function load() {
       $(".device").each(function() {
          var dropdown = this;
          robot.forEach(function(element,i) {
            console.log(element.name)
           $(dropdown).append($("<option>", {
               text: element.name
           }));
          });
       });
   }

   setTimeout(load, 2000);



});
  </script>
  <body>

<div class="container">
    <div class="row clearfix">
    <div class="col-md-12 column">
      <table class="table table-bordered table-hover" id="tab_logic">
        <thead>
          <tr >
            <th class="text-center">
              #
            </th>
            <th class="text-center">
              Device
            </th>
            <th class="text-center">
              Event
            </th>
            <th class="text-center">
              Device
            </th>
            <th class="text-center">
              Command
            </th>
          </tr>
        </thead>
        <tbody>
          <tr id='row0'>
            <td>
            1
            </td>
            <td>
            <select name='deviceEvent0' class="device">
            </select>
            </td>
            <td>
            <select name='event0' class="event">
            </select>
            </td>
            <td>
            <select name='deviceCommand0' class="device">
            </select>
            </td>
            <td>
            <select name='command0' class="command">
            </select>
            </td>
          </tr>
                    <tr id='row1'></tr>
        </tbody>
      </table>
    </div>
  </div>
  <a id="add_row" class="btn btn-default pull-left">Add Row</a><a id='delete_row' class="pull-right btn btn-default">Delete Row</a>
</div>
    <ul id="messages"></ul>
  </body>
</html>
